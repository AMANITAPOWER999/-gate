# Goldantelopegate_v1.0 - TOP 1 Gainer Trading Bot

## Overview

This is a Python-based cryptocurrency trading bot for Gate.io exchange with x5 leverage. The bot dynamically selects the #1 top gainer from 591 futures pairs and trades it using a 30m Parabolic SAR strategy. Executes **ONLY LONG positions** with real market data in paper trading mode. Features Flask web dashboard with real-time chart visualization and Telegram notifications.

## System Architecture

The application follows a modular architecture with clear separation of concerns:

- **Flask Web Application**: Dashboard for monitoring and controlling the trading bot
- **Trading Bot Core**: Implements Parabolic SAR strategy with x5 leverage
- **Market Simulator**: Testing environment for strategy validation
- **Telegram Integration**: Real-time notifications and WebApp interface
- **Signal Sender**: External webhook integration for automated trading

## Key Components

### Core Files

1. **app.py** - Flask web application and API endpoints
   - Dashboard routes (`/`, `/webapp`)
   - API endpoints for bot control (`/api/start_bot`, `/api/stop_bot`, etc.)
   - Status and monitoring endpoints

2. **trading_bot.py** - Core trading logic
   - Parabolic SAR strategy implementation
   - Position management (open/close)
   - OHLCV data fetching and analysis
   - Paper trading and live trading modes

3. **market_simulator.py** - Market simulation for testing
   - Generates realistic price movements
   - Produces OHLCV data for backtesting
   - Configurable volatility

4. **telegram_notifications.py** - Telegram bot integration
   - Position opened/closed notifications
   - Balance and P&L updates
   - Subscriber management

5. **signal_sender.py** - External signal dispatch
   - Webhook integration for automated trading
   - LONG/SHORT signal sending

### Frontend Files

- **templates/dashboard.html** - Main web dashboard
- **templates/webapp.html** - Telegram WebApp interface
- **static/css/dashboard.css** - Dashboard styling
- **static/js/dashboard.js** - Dashboard JavaScript logic

### State Files

- **goldantelopegate_v1.0_state.json** - Trading state (balance, positions, trades)
- **goldantelopegate_v1.0_btc_state.json** - BTC trading state (for future use)

## Configuration

### Environment Variables

| Variable | Description | Default |
|----------|-------------|---------|
| GATE_API_KEY | Gate.io API key | - |
| GATE_API_SECRET | Gate.io API secret | - |
| RUN_IN_PAPER | Paper trading mode (1=on, 0=off) | 1 |
| USE_SIMULATOR | Use market simulator (1=on, 0=off) | 1 |
| TELEGRAM_BOT_TOKEN | Telegram bot token | - |
| TELEGRAM_CHAT_ID | Telegram chat ID | - |
| DASHBOARD_PASSWORD | Dashboard password | admin |
| SESSION_SECRET | Flask session secret | auto-generated |

### Trading Parameters

- **Leverage**: x5
- **Position Size**: 100% of available balance (Balance × x5 notional)
- **Symbol**: Dynamic TOP 1 gainer from Gate.io
- **Primary Timeframe**: 30m Parabolic SAR (checked every 5 seconds)
- **Strategy Mode**: 30m SAR LONG entry/exit with SAR direction changes

## Strategy

### Parabolic SAR 30m LONG Trading Logic

**ENTRY RULES:**
- Position opens when **30m SAR = SHORT**
  - Checks 30m SAR every 5 seconds
  - Opens LONG position when SAR direction is SHORT
  - At startup: If 30m SAR is already SHORT, opens immediately; if LONG, waits for change

**EXIT RULES:**
- Position closes when 30m SAR **direction changes** (from SHORT to LONG)
- Automatic re-entry: When 30m SAR becomes SHORT again

**Position Type:**
- **ONLY LONG positions** - no SHORT positions ever opened
- Leverage: **x5**
- Position Size: **100% of available balance (Balance × x5 notional)**
- Trading Symbol: **Dynamic TOP 1 gainer** from Gate.io (updated every 60 seconds)

## API Endpoints

| Endpoint | Method | Description |
|----------|--------|-------------|
| `/api/status` | GET | Get bot status, balance, positions |
| `/api/start_bot` | POST | Start trading bot |
| `/api/stop_bot` | POST | Stop trading bot |
| `/api/close_position` | POST | Force close current position |
| `/api/delete_last_trade` | POST | Delete last trade record |
| `/api/reset_balance` | POST | Reset balance to $100 |
| `/api/chart_data` | GET | Get chart data with markers |
| `/api/debug_sar` | GET | SAR indicator debug info |
| `/api/top_gainers` | GET | Get top 590 Gate.io futures gainers |

## Deployment

### Running Locally
```bash
python app.py
```

### Dashboard Access
- Web Dashboard: `http://localhost:5000/`
- Telegram WebApp: `http://localhost:5000/webapp`

### Railway Deployment
- Live URL: `mexctradingbotv10-pocketoptionbotv10.up.railway.app` (port 8080)

## Recent Changes

- **November 30, 2025 - STRATEGY FLIP TO LONG:**
  - ✅ Changed from SHORT-only to LONG-only strategy
  - ✅ Entry: 30m SAR = SHORT → Open LONG position
  - ✅ Exit: 30m SAR changes direction → Close LONG position
  - ✅ Fixed start_bot endpoint to be idempotent (returns 200 instead of 400 when bot running)
  - ✅ Closed legacy SHORT position from previous session ($43.56 balance remaining)

- November 29, 2025: **Final SHORT fix (now historical):**
  - Removed "EXCEPTION" logic that opened SHORT regardless of SAR direction
  - Position opened ONLY when 30m SAR changes to SHORT
  - Position closed when 30m SAR changed direction

- November 29, 2025: Removed Chinese symbols (币安人生) from TOP gainers list - now filters only ASCII pairs
- November 29, 2025: Fixed symbol format - TRADOOR_USDT stays in Gate.io format (underscore, not slash)
- November 29, 2025: Fixed P&L calculation - now uses notional (Balance × x5) correctly
- November 29, 2025: Added TOP 1 price support - position opens with real gainer price from top_gainers API
- November 29, 2025: Updated API response with correct position fields
- November 29, 2025: Implemented dynamic TOP 1 gainer selection from all 591 Gate.io futures pairs

## User Preferences

- **Exchange**: Gate.io
- **Trading Pair**: Dynamic TOP 1 gainer (changes every 60 seconds)
- **Leverage**: x5
- **Strategy**: 30m Parabolic SAR - **LONG ONLY** ✅
- **Mode**: Paper Trading (virtual balance)
- **Language**: Russian language preferred
- **Top Gainers**: All Gate.io ASCII futures contracts with 24h % change (no Chinese symbols)
- **Position Logic**: Open LONG when 30m SAR = SHORT, close when SAR direction changes

## GitHub Repository

Repository: `manuninkirill-bot/tradingbot`  
Last Updated: November 30, 2025

